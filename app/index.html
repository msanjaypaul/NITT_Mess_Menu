<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="NITT Mess Menu - Get your daily mess meal schedule">
    <meta name="theme-color" content="#A8DF8E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NITT Mess">
    
    <title>NITT Mess Menu</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="../Logo.png">
    <link rel="apple-touch-icon" href="../Logo.png">
    
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <div class="logo-section">
                    <div class="nav-arrows">
                        <button class="arrow-btn" id="prevBtn">‚Äπ</button>
                        <h1 class="app-title">NITT Menu</h1>
                        <button class="arrow-btn" id="nextBtn">‚Ä∫</button>
                    </div>
                </div>
                <button class="profile-btn" id="profileBtn" title="Settings">
                    <img src="../Logo.png" alt="Settings" class="profile-logo">
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mess Selector -->
            <section class="selector-section">
                <div class="selector-group">
                    <label for="messSelect">Select Mess</label>
                    <select id="messSelect" class="mess-select">
                        <option value="">Loading messes...</option>
                    </select>
                </div>
            </section>

            <!-- Day Selector -->
            <section class="day-selector-section">
                <div class="day-scroll-container">
                    <div class="day-selector" id="daySelector">
                        <!-- Days will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Menu Display -->
            <section class="menu-section">
                <div id="menuContainer" class="menu-container">
                    <div class="placeholder">
                        <p>üìã Select a mess and day to view the menu</p>
                    </div>
                </div>
            </section>

            <!-- Loading State -->
            <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
            </div>
        </main>
    </div>

    <!-- Profile & Settings Modal -->
    <div id="profileModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ Profile & Settings</h2>
                <button class="modal-close" onclick="closeModal('profileModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Appearance -->
                <div class="settings-section">
                    <h3 class="section-title">üé® Appearance</h3>
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="darkMode" class="checkbox-input">
                            <span>Dark Mode</span>
                        </label>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="settings-section">
                    <h3 class="section-title">üîî Notifications</h3>
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="enableNotifications" class="checkbox-input">
                            <span>Enable Notifications</span>
                        </label>
                    </div>
                </div>

                <!-- Data & Storage -->
                <div class="settings-section">
                    <h3 class="section-title">üíæ Data & Storage</h3>
                    <div class="setting-item">
                        <button class="btn-secondary" onclick="syncMenuData()">üîÑ Sync Menu Data</button>
                    </div>
                    <div class="setting-item">
                        <button class="btn-secondary" onclick="clearCache()">üóëÔ∏è Clear Cache</button>
                    </div>
                </div>

                <!-- About -->
                <div class="settings-section">
                    <h3 class="section-title">‚ÑπÔ∏è About</h3>
                    <div class="setting-item">
                        <p class="version-text">NITT Mess Menu App<br>Version 1.0.0</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/notifications.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').then(registration => {
                console.log('‚úÖ Service Worker registered:', registration);
            }).catch(error => {
                console.log('‚ùå Service Worker registration failed:', error);
            });
        }
        
        // Debug check on load
        window.addEventListener('load', () => {
            console.log('üîç App loaded, checking status...');
            console.log('Published data exists:', !!localStorage.getItem('publishedMenuData'));
            console.log('Admin data exists:', !!localStorage.getItem('adminMenuData'));
            
            // Auto-publish if admin data exists but published doesn't
            if (localStorage.getItem('adminMenuData') && !localStorage.getItem('publishedMenuData')) {
                console.log('üì§ Auto-publishing admin data...');
                const adminData = localStorage.getItem('adminMenuData');
                localStorage.setItem('publishedMenuData', adminData);
                console.log('‚úÖ Data published! Reloading...');
                setTimeout(() => location.reload(), 500);
            }
        });
    </script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
